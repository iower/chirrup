<button id="button">Play</button>

<script>
	
	const audioCtx = new AudioContext;
	
	
	// generator
	
	const a = 0.5;
	const freq = 18000;
	
	button.onclick = () => {
		//const message = '11001100101010';
		sendMessage();
	};
	
	const sendMessage = () => {
		// todo: message
		setInterval(() => {
			playSine(200);
			//console.log('test');
		}, 500);
	};
	
	const playSine = (durationMs) => {
		
		const numberOfChannels = 1;
		const sampleRate = audioCtx.sampleRate;
		
		const frameCount = audioCtx.sampleRate * durationMs  / 1000;
		const someBuffer = audioCtx.createBuffer(numberOfChannels, frameCount, sampleRate);
		
		const bufferData = someBuffer.getChannelData(numberOfChannels - 1);
		
		//const freq = 17000;
		
		const frameT = 1 / audioCtx.sampleRate;
		
		
		for (let i = 0; i < frameCount; i++) {
			const t = frameT * i;
			bufferData[i] = a * Math.sin(freq * t * 2 * Math.PI); // data item must be [-1.0; 1.0]
		}
		
		const source = audioCtx.createBufferSource(); // create AudioBufferSourceNode
		source.buffer = someBuffer;
		source.connect(audioCtx.destination);
		source.start();
		
	};
	
	// analyzer
	
	
	if (navigator.mediaDevices) {
		navigator.mediaDevices.getUserMedia({audio: true, /*video: true*/}).then(function(stream) {
			
			//var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
			var analyser = audioCtx.createAnalyser();
			
			analyser.fftSize = 32;
			analyser.minDecibels = -110;
			analyser.maxDecibels = -10;
			analyser.smoothingTimeConstant = 0; // 0..1 (0 = no time averaging). Default 0.8.
			
			source = audioCtx.createMediaStreamSource(stream);
			source.connect(analyser);
			
			
			// create array to recieve data
			
			var bufferLength = analyser.frequencyBinCount;
			
			
			setInterval(() => {
				fFrequencyData = new Float32Array(bufferLength);
				//bFrequencyData = new Uint8Array(bufferLength); 
				//bTimeData = new Uint8Array(bufferLength);
				
				analyser.getFloatFrequencyData(fFrequencyData);
				//analyser.getByteFrequencyData(bFrequencyData);
				//analyser.getByteTimeDomainData(bTimeData);
				
				for (var i = 0; i < bufferLength; i++) {
					console.log(fFrequencyData[i]);
				}
				
				console.log('-----');
				
				for (var i = 0; i < bufferLength; i++) {
					//console.log(bFrequencyData[i]);
				}
				
				for (var i = 0; i < bufferLength; i++) {
					//console.log(bTimeData[i]);
				}
			}, 1000);
			
			
			
		});
	}
	
	
</script>